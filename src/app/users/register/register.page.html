<ion-header>
  <ion-toolbar color="secondary">
    <ion-title>¡Regístrate!</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div>
    <ion-card>
      <div class="flex-center">
        <ion-avatar slot="start" style="background-color: #8b4513;">
          <img src="../../assets/icon/Logo_name_out.png" alt="avatar" />
        </ion-avatar>
      </div>

      <ion-card-header class="ion-text-center"
        style="border-top: 0.5px solid #0000003d; margin: 10px; padding-bottom: 10px;">
        <ion-card-title color="primary">Crea tu cuenta</ion-card-title>
      </ion-card-header>

      <ion-card-content>


        <form (ngSubmit)="registrarse()">

          <!-- Foto -->
          <ion-item style="align-items: center; flex-direction: column;">
            <ion-button (click)="takePicture()">Foto Perfil</ion-button><br>

            <div style="margin-top: 15px; display: flex; justify-content: center; align-items: center;">
              <ion-avatar
                style="background-color: #F5F5DC; width: 120px; height: 120px; border-radius: 50%; overflow: hidden;">
                <img *ngIf="foto_perfil" [src]="foto_perfil" alt="avatar"
                  style="width: 100%; height: 100%; object-fit: cover;" />
              </ion-avatar>
            </div>
          </ion-item>

          <!-- Nombre -->
          <ion-item>
            <ion-label position="floating">Nombre</ion-label>
            <ion-input type="text" [(ngModel)]="pNombre" name="pNombre" required minlength="2" #pNombreCtrl="ngModel"></ion-input>
            <ion-button fill="outline" slot="end" (click)="clearPNombre()">
              <ion-icon name="trash-bin-sharp" color="danger"></ion-icon>
            </ion-button>
          </ion-item>
          <div *ngIf="pNombreCtrl.invalid && (pNombreCtrl.dirty || pNombreCtrl.touched)" class="error-message">
            El primer nombre es obligatorio y debe tener entre 2 y 40 caracteres.
          </div>

          <!-- Apellido Paterno -->
          <ion-item>
            <ion-label position="floating">Apellido Paterno</ion-label>
            <ion-input type="text" [(ngModel)]="aPaterno" name="aPaterno" required minlength="2" #aPaternoCtrl="ngModel"></ion-input>
            <ion-button fill="outline" slot="end" (click)="clearAPaterno()">
              <ion-icon name="trash-bin-sharp" color="danger"></ion-icon>
            </ion-button>
          </ion-item>
          <div *ngIf="aPaternoCtrl.invalid && (aPaternoCtrl.dirty || aPaternoCtrl.touched)" class="error-message">
            El apellido paterno es obligatorio y debe tener entre 2 y 40 caracteres.
          </div>

          <!-- Segundo Nombre -->
          <ion-item>
            <ion-label position="floating">Segundo Nombre (Opcional)</ion-label>
            <ion-input type="text" [(ngModel)]="sNombre" name="sNombre" #sNombreCtrl="ngModel"></ion-input>
            <ion-button fill="outline" slot="end" (click)="clearSNombre()">
              <ion-icon name="trash-bin-sharp" color="danger"></ion-icon>
            </ion-button>
          </ion-item>
          <div *ngIf="sNombreCtrl.invalid && (sNombreCtrl.dirty || sNombreCtrl.touched)" class="error-message">
            El segundo nombre debe tener al menos 2 caracteres y no contener números.
          </div>

          <!-- Apellido Materno -->
          <ion-item>
            <ion-label position="floating">Apellido Materno (Opcional)</ion-label>
            <ion-input type="text" [(ngModel)]="aMaterno" name="aMaterno" #aMaternoCtrl="ngModel"></ion-input>
            <ion-button fill="outline" slot="end" (click)="clearAMaterno()">
              <ion-icon name="trash-bin-sharp" color="danger"></ion-icon>
            </ion-button>
          </ion-item>
          <div *ngIf="aMaternoCtrl.invalid && (aMaternoCtrl.dirty || aMaternoCtrl.touched)" class="error-message">
            El apellido materno debe tener al menos 2 caracteres y no contener números.
          </div>

          <!-- Empresa -->
          <ion-item>
            <ion-label position="floating">Empresa (Opcional)</ion-label>
            <ion-input type="text" [(ngModel)]="empresa" name="empresa" (ionChange)="onFieldsChange()" #empresaCtrl="ngModel"></ion-input>
            <ion-button fill="outline" slot="end" (click)="clearEmpresa()" (ionChange)="onFieldsChange()">
              <ion-icon name="trash-bin-sharp" color="danger"></ion-icon>
            </ion-button>
          </ion-item>
          <div *ngIf="empresaCtrl.invalid && (empresaCtrl.dirty || empresaCtrl.touched)" class="error-message">
            El nombre de la empresa debe entre 3 y 30 caracteres y solo puede contener letras, números y espacios.
          </div>


          <!-- Descripción Corta -->
          <ion-item>
            <ion-label position="floating">Descripción Corta (Opcional)</ion-label>
            <ion-textarea [(ngModel)]="descripcion_corta" name="descripcion_corta" (ionChange)="onFieldsChange()" #descEmpresaCtrl="ngModel"></ion-textarea>
            <ion-button fill="outline" slot="end" (click)="clearDescEmpresa()" (ionChange)="onFieldsChange()">
              <ion-icon name="trash-bin-sharp" color="danger"></ion-icon>
            </ion-button>
          </ion-item>
          <div *ngIf="descEmpresaCtrl.invalid && (descEmpresaCtrl.dirty || descEmpresaCtrl.touched)" class="error-message">
            La descripción de la empresa debe tener al menos 10 caracteres y máximo 90, solo puede contener letras, números y espacios.
          </div>

          <!-- Email -->
          <ion-item>
            <ion-input label="Correo" type="email" [(ngModel)]="email" labelPlacement="stacked" name="email" placeholder="Ingresar Correo" required email #emailCtrl="ngModel"></ion-input>
            <ion-button fill="outline" slot="end" (click)="clearMail()">
              <ion-icon name="trash-bin-sharp" color="danger"></ion-icon>
            </ion-button>

          </ion-item>
          <div *ngIf="emailCtrl.invalid && (emailCtrl.dirty || emailCtrl.touched)" class="error-message">
            El email es obligatorio y debe tener un formato válido.
          </div>

          <!-- Contraseña -->
          <ion-item>
            <ion-input label="Contraseña" type="password" [(ngModel)]="password" labelPlacement="stacked"
              placeholder="Ingresar Contraseña" name="password" required minlength="10" #passwordCtrl="ngModel">
              <div slot="end">
                <ion-input-password-toggle></ion-input-password-toggle>
              </div>
            </ion-input>
          </ion-item>
          <div *ngIf="passwordCtrl.invalid && (passwordCtrl.dirty || passwordCtrl.touched)" class="error-message">
            Requisitos Contraseña: 
              Entre 10 y 30 caracteres.
              Minimo 1 caracter especial.
              No tener caracteres o numeros consecutivos.
              Tener 2 letras mayusculas.
          </div>

          <!-- Región -->
          <ion-item>
            <ion-label>Región</ion-label>
            <ion-select [(ngModel)]="selectedRegion" #regionCtrl="ngModel" (ionChange)="cargarcomunas($event)" name="region" required>
              <ion-select-option *ngFor="let region of regiones" [value]="region.id">
                {{ region.nombre }}
              </ion-select-option>
            </ion-select>
          </ion-item>
          <div *ngIf="regionCtrl.invalid && (regionCtrl.dirty || regionCtrl.touched)" class="error-message">
            La región es obligatoria.
          </div>

          <!-- Comuna -->
          <ion-item>
            <ion-label>Comuna</ion-label>
            <ion-select [(ngModel)]="selectedComuna" name="comuna" #comunaCtrl="ngModel" required [disabled]="!selectedRegion">
              <ion-select-option *ngFor="let comuna of comunas" [value]="comuna.id">
                {{ comuna.nombre }}
              </ion-select-option>
            </ion-select>
          </ion-item>
          <div *ngIf="comunaCtrl.invalid && (comunaCtrl.dirty || comunaCtrl.touched)" class="error-message">
            La comuna es obligatoria.
          </div>      

          <!-- Dirección -->
          <ion-item>
            <ion-label position="floating">Dirección</ion-label>
            <ion-input id="autoscroll-input" type="text" [(ngModel)]="direccion" name="direccion" required #dirCtrl="ngModel" placeholder="Escribe la ubicación o usa el Marcador (automatico)"></ion-input>
            <ion-button fill="outline" slot="end" (click)="clearDirr()">
              <ion-icon name="trash-bin-sharp" color="danger"></ion-icon>
            </ion-button>
            <ion-button fill="outline" slot="end" (click)="useCurrentLocation()">
              <ion-icon name="location-sharp"></ion-icon>
            </ion-button>
          </ion-item>
          <div *ngIf="dirCtrl.invalid && (dirCtrl.dirty || dirCtrl.touched)" class="error-message">
            La dirección es obligatoria y debe tener un formato válido.
          </div>

          <ion-button type="submit" fill="solid" expand="full">Registrarse</ion-button>
        </form>

        <ion-button fill="clear" expand="full" routerLink="/login">¿Ya tienes cuenta? ¡Ingresa!</ion-button>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>